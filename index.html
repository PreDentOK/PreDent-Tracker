<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f1c5e">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <title>PreDent Connect | Hours Tracker</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@300;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

<div class="pd-tracker-wrapper" id="tracker-app">
    
    <div class="pd-header-banner">
        <div class="pd-logo-text">
            <span class="brand-prefix">PRE</span><span class="brand-main">DENT</span>
            <span class="brand-suffix">HOURS</span>
        </div>
        
        <div class="pd-tabs-container">
            <button class="pd-tab-btn active" onclick="switchTab('tracker')">Log</button>
            <button class="pd-tab-btn" onclick="switchTab('stats')">Stats</button>
            <button class="pd-tab-btn" onclick="switchTab('leaderboard')">Ranking</button>
        </div>

        <div class="pd-actions-group">
            <div id="auth-section">
                <button id="btn-google-login" class="pd-auth-btn" onclick="googleLogin()">
                    <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.36 19.27 5 16.25 5 12c0-4.1 3.2-7.27 7.2-7.27 3.09 0 4.9 1.97 4.9 1.97L19 4.72S16.56 2 12.1 2C6.42 2 2.03 6.8 2.03 12c0 5.05 4.13 10 10.22 10 5.35 0 9.25-3.67 9.25-9.09 0-1.15-.15-1.81-.15-1.81z"/></svg>
                    Sign In
                </button>
                <div id="user-profile" class="pd-user-profile hidden">
                    <div class="pd-nav-rank" id="nav-rank-badge">#--</div>
                    <button class="pd-profile-btn" onclick="toggleProfileMenu(event)">
                        <img id="user-avatar" src="" alt="Profile" class="pd-avatar-img">
                    </button>
                    <div id="profile-dropdown" class="pd-dropdown" style="width: 150px;">
                        <div class="pd-menu-item header-item" id="dropdown-name">User</div>
                        <button class="pd-menu-item" onclick="openEditNameModal()">Edit Name</button>
                        <button class="pd-menu-item pd-menu-danger" onclick="googleLogout()">Sign Out</button>
                    </div>
                </div>
            </div>

            <div class="pd-menu-container">
                <button class="pd-menu-btn" onclick="toggleOptionsMenu(event)" aria-label="Options" id="btn-options-toggle">
                    <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                </button>
                <div id="pd-options-dropdown" class="pd-dropdown">
                    <button class="pd-menu-item" onclick="refreshAppPage()">Refresh App</button>
                    <button class="pd-menu-item" onclick="exportData()">Export CSV</button>
                    <button class="pd-menu-item" onclick="triggerImport()">Import CSV</button>
                    <div style="height:1px; background:rgba(255,255,255,0.1); margin:5px 0;"></div>
                    <button class="pd-menu-item pd-menu-danger" onclick="openResetModal()">Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <div class="pd-content-body">
        
        <div class="pd-stats-container">
            <div class="pd-circle-card">
                <svg class="pd-progress-ring" viewBox="0 0 260 260">
                    <circle class="pd-progress-ring__bg" stroke="rgba(255,255,255,0.1)" stroke-width="16" fill="transparent" r="110" cx="130" cy="130"/>
                    <circle id="ring-shadow" class="pd-progress-ring__circle" stroke="#4da6ff" stroke-width="16" stroke-linecap="round" fill="transparent" r="110" cx="130" cy="130"/>
                </svg>
                <div class="pd-circle-content">
                    <span class="pd-stat-number" id="total-shadow" style="color: #4da6ff;">0</span>
                    <span class="pd-stat-label">Shadow Hours</span>
                </div>
            </div>
            <div class="pd-circle-card">
                <svg class="pd-progress-ring" viewBox="0 0 260 260">
                    <circle class="pd-progress-ring__bg" stroke="rgba(255,255,255,0.1)" stroke-width="16" fill="transparent" r="110" cx="130" cy="130"/>
                    <circle id="ring-volunteer" class="pd-progress-ring__circle" stroke="#ffd700" stroke-width="16" stroke-linecap="round" fill="transparent" r="110" cx="130" cy="130"/>
                </svg>
                <div class="pd-circle-content">
                    <span class="pd-stat-number" id="total-volunteer" style="color: #ffd700;">0</span>
                    <span class="pd-stat-label">Volunteer Hours</span>
                </div>
            </div>
        </div>

        <div id="view-tracker" class="pd-view active">
            <h2 class="pd-section-title">Activity Log <span id="filter-badge" class="pd-filter-badge">FILTERED</span></h2>
            
            <div class="pd-form-card" id="input-form-card">
                <div class="pd-form-header">
                    <span>Log New Hours</span>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <div class="pd-input-wrapper">
                        <select id="entry-type" class="pd-select" required>
                            <option value="Shadowing">Shadowing</option>
                            <option value="Volunteering">Volunteering</option>
                        </select>
                    </div>
                </div>

                <div class="pd-form-grid">
                    <div class="pd-input-wrapper">
                        <input type="date" id="entry-date" class="pd-input" required>
                        <span class="pd-error-asterisk">*</span>
                    </div>
                    <div class="pd-input-wrapper">
                        <select id="entry-subtype" class="pd-select" required></select>
                        <span class="pd-error-asterisk">*</span>
                    </div>
                </div>

                <div class="pd-form-grid">
                    <div class="pd-input-wrapper">
                        <input type="number" id="entry-hours" class="pd-input" placeholder="Hours (Full numbers)" step="1" min="1" required>
                        <span class="pd-error-asterisk">*</span>
                    </div>
                    <div class="pd-input-group pd-input-wrapper">
                        <input type="text" id="entry-doctor" class="pd-input" placeholder="Doctor(s)" list="doc-suggestions" autocomplete="off" required>
                        <a href="https://oklahoma.gov/dentistry/license-verification/verify-a-dentist.html" target="_blank" class="pd-verify-link" title="Verify License">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        </a>
                        <datalist id="doc-suggestions"></datalist>
                        <span class="pd-error-asterisk" style="right: 40px;">*</span>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <div class="pd-input-wrapper">
                        <input type="text" id="entry-loc" class="pd-input" placeholder="Location / Address" list="loc-suggestions" autocomplete="off" required>
                        <datalist id="loc-suggestions"></datalist>
                        <span class="pd-error-asterisk">*</span>
                    </div>
                </div>

                <div style="margin-bottom: 1rem;">
                    <input type="text" id="entry-notes" class="pd-input" placeholder="Notes (Optional)...">
                </div>

                <div class="pd-form-actions">
                    <button id="btn-add-entry" class="pd-btn pd-btn-primary" onclick="addEntry()">ADD ENTRY</button>
                </div>
            </div>

            <div class="pd-list-controls">
                <input type="text" id="search-input" placeholder="Search entries..." onkeyup="handleSearch()">
                
                <div style="display:flex; gap:5px;">
                    <div class="pd-menu-container" id="pd-filter-container">
                        <button class="pd-menu-btn" onclick="toggleFilterMenu(event)" aria-label="Filter" id="btn-filter-toggle">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg>
                        </button>
                        <div id="pd-filter-dropdown" class="pd-dropdown">
                            <button class="pd-menu-item" onclick="setFilter('All')">Show All</button>
                            <button class="pd-menu-item" onclick="setFilter('Shadowing')">Shadowing</button>
                            <button class="pd-menu-item" onclick="setFilter('Volunteering')">Volunteering</button>
                        </div>
                    </div>
                    
                    <button id="btn-select-mode" onclick="toggleSelectionMode()">Select Entries</button>
                    <button id="btn-delete-selected" onclick="deleteSelectedEntries()" disabled>Delete</button>
                </div>
            </div>

            <div id="log-list" class="pd-list">
                <ul id="log-list-ul"></ul>
            </div>
        </div>

        <div id="view-stats" class="pd-view">
            <h2 class="pd-section-title">Trends & Insights</h2>
            <div id="stats-content">
                <div class="pd-form-grid">
                    <div class="pd-trend-card"><h4>Unique Dentists</h4><div class="pd-trend-stat" id="stat-unique-docs">0</div></div>
                    <div class="pd-trend-card"><h4>Total Entries</h4><div class="pd-trend-stat" id="stat-total-entries">0</div></div>
                </div>
                <div class="pd-trend-card"><h4>Top Specialties</h4><ul class="pd-trend-list" id="list-top-specialties"><div class="pd-trend-empty">No data available</div></ul></div>
                <div class="pd-trend-card"><h4>Volunteer Experience Mix</h4><ul class="pd-trend-list" id="list-vol-mix"><div class="pd-trend-empty">No data available</div></ul></div>
                
                <div class="pd-trend-card">
                    <h4>Monthly Activity</h4>
                    <div id="activity-chart" class="pd-chart-container"></div>
                </div>
            </div>
        </div>

        <div id="view-leaderboard" class="pd-view">
            <h2 class="pd-section-title">Community Leaderboard</h2>
            <div id="signin-promo" style="text-align:center; padding:2rem; background:rgba(255,255,255,0.05); border-radius:12px;">
                <p>Sign in with Google to see how you rank against other PreDental students!</p>
                <button class="pd-btn pd-btn-primary" onclick="googleLogin()">Sign In Now</button>
            </div>
            <div class="pd-lb-profile pd-hidden" id="lb-profile-box">
                <h4>Leaderboard Profile</h4>
                <p>Your Google name is used by default. Enter a display name below to override it.</p>
                <div class="pd-lb-input-row">
                    <input type="text" id="user-display-name" class="pd-input" placeholder="Display Name">
                    <button class="pd-btn pd-btn-primary" onclick="updateProfileName()" style="width: auto;">Update</button>
                    <button class="pd-btn pd-btn-cancel" onclick="skipProfileSetup()" style="width: auto; margin-right:0;">Skip</button>
                </div>
            </div>
            <div class="pd-leaderboard-card pd-hidden" id="lb-card-main">
                <div class="pd-lb-header"><div>Rank</div><div>Name</div><div>Shadow</div><div>Volunteer</div></div>
                <div id="leaderboard-list">
                    <div style="padding:2rem; text-align:center; color:#cbd5e1;">Syncing scores...</div>
                </div>
            </div>
        </div>

    </div>

    <footer class="pd-footer">Â© <span id="year"></span> PreDent Connect. All rights reserved.</footer>

    <div id="reset-modal" class="pd-modal-overlay">
        <div class="pd-modal pd-modal-danger">
            <h3>RESET ALL DATA?</h3>
            <p>This cannot be undone.</p>
            <p style="margin-bottom:1rem;">Type <strong>DELETE</strong> below:</p>
            <input type="text" id="reset-confirm-input" class="pd-input" style="text-align:center; text-transform:uppercase; margin-bottom:1rem;" onkeyup="checkResetInput()">
            <div style="display:flex; justify-content:center;"><button class="pd-btn pd-btn-cancel" onclick="closeResetModal()">Cancel</button><button id="reset-confirm-btn" class="pd-btn pd-btn-danger" onclick="confirmReset()" disabled>Wipe Data</button></div>
        </div>
    </div>

    <div id="delete-modal" class="pd-modal-overlay">
        <div class="pd-modal pd-modal-danger">
            <h3>DELETE ENTRY?</h3>
            <p style="margin-bottom:1.5rem;">Are you sure you want to remove this log entry? This cannot be undone.</p>
            <div style="display:flex; justify-content:center; gap:10px;">
                <button class="pd-btn pd-btn-cancel" onclick="closeDeleteModal()">No, Keep it</button>
                <button class="pd-btn pd-btn-danger" onclick="confirmDeleteEntry()">Yes, Delete</button>
            </div>
        </div>
    </div>

    <div id="edit-name-modal" class="pd-modal-overlay">
        <div class="pd-modal">
            <h3>EDIT DISPLAY NAME</h3>
            <p style="margin-bottom:1rem;">This is the name others see on the leaderboard.</p>
            <input type="text" id="edit-name-input" class="pd-input" placeholder="Enter new name" style="margin-bottom:1rem;">
            <div style="display:flex; justify-content:center; gap:10px;">
                <button class="pd-btn pd-btn-cancel" onclick="closeEditNameModal()">Cancel</button>
                <button class="pd-btn pd-btn-primary" onclick="saveNewName()">Save Name</button>
            </div>
        </div>
    </div>

    <div id="edit-modal" class="pd-modal-overlay">
        <div class="pd-modal" style="width: 100%; max-width: 500px; padding: 1.5rem;">
            <h3 style="color:#4da6ff; margin-bottom: 1rem;">EDIT ENTRY</h3>
            <div style="text-align:left; margin-bottom: 1rem;">
                <div style="margin-bottom: 1rem;">
                    <label style="color:#cbd5e1; font-size:0.8rem;">Type</label>
                    <select id="edit-entry-type" class="pd-select">
                        <option value="Shadowing">Shadowing</option>
                        <option value="Volunteering">Volunteering</option>
                    </select>
                </div>
                <div class="pd-form-grid">
                    <div>
                        <label style="color:#cbd5e1; font-size:0.8rem;">Date</label>
                        <input type="date" id="edit-entry-date" class="pd-input">
                    </div>
                    <div>
                        <label style="color:#cbd5e1; font-size:0.8rem;">Subtype</label>
                        <select id="edit-entry-subtype" class="pd-select"></select>
                    </div>
                </div>
                <div class="pd-form-grid">
                    <div>
                        <label style="color:#cbd5e1; font-size:0.8rem;">Hours</label>
                        <input type="number" id="edit-entry-hours" class="pd-input" step="any" inputmode="decimal">
                    </div>
                    <div>
                        <label style="color:#cbd5e1; font-size:0.8rem;">Doctor/Supervisor</label>
                        <input type="text" id="edit-entry-doctor" class="pd-input" list="doc-suggestions">
                    </div>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="color:#cbd5e1; font-size:0.8rem;">Location</label>
                    <input type="text" id="edit-entry-loc" class="pd-input" list="loc-suggestions">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="color:#cbd5e1; font-size:0.8rem;">Notes</label>
                    <input type="text" id="edit-entry-notes" class="pd-input">
                </div>
            </div>
            <div style="display:flex; justify-content:center; gap:10px;">
                <button class="pd-btn pd-btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="pd-btn pd-btn-primary" onclick="saveEditEntry()">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="view-modal" class="pd-modal-overlay">
        <div class="pd-modal" id="view-modal-content" style="width: 100%; max-width: 450px; padding: 2rem;">
            <h3 id="view-type-title" style="color:#4da6ff; margin-bottom: 0.5rem; text-transform:uppercase;">ENTRY DETAILS</h3>
            <p id="view-subtype" style="margin-bottom:1.5rem; opacity:0.8;"></p>
            
            <div class="pd-view-row">
                <span class="pd-view-label">Date</span>
                <span class="pd-view-val" id="view-date">--</span>
            </div>
            <div class="pd-view-row">
                <span class="pd-view-label">Hours</span>
                <span class="pd-view-val" id="view-hours">--</span>
            </div>
            <div class="pd-view-row">
                <span class="pd-view-label">Doctor/Supervisor</span>
                <span class="pd-view-val" id="view-doc">--</span>
            </div>
            <div class="pd-view-row">
                <span class="pd-view-label">Location</span>
                <span class="pd-view-val" id="view-loc">--</span>
            </div>
            
            <div id="view-notes-container" class="pd-view-notes">
                </div>

            <div style="display:flex; justify-content:center; margin-top:2rem;">
                <button class="pd-btn pd-btn-primary" onclick="document.getElementById('view-modal').style.display='none'">Close</button>
            </div>
        </div>
    </div>

    <div id="warning-modal" class="pd-modal-overlay">
        <div class="pd-modal" style="border-color: #ffd700;">
            <h3 style="color: #ffd700;">NAME NOT ALLOWED</h3>
            <p>We want to keep PreDent Connect professional for everyone.</p>
            <p style="margin-bottom:1rem;">Please choose a different display name that does not contain suggestive or inappropriate language.</p>
            <div style="display:flex; justify-content:center;">
                <button class="pd-btn pd-btn-primary" onclick="document.getElementById('warning-modal').style.display='none'">Understood</button>
            </div>
        </div>
    </div>
    
    <div id="signin-prompt-modal" class="pd-modal-overlay">
        <div class="pd-modal" style="border: 1px solid #4da6ff;">
            <h3 style="color:#4da6ff">SAVE YOUR PROGRESS</h3>
            <p>Sign in with Google to sync your hours across devices and join the leaderboard.</p>
            <div style="display:flex; justify-content:center; gap:10px; margin-top:1rem;">
                <button class="pd-btn pd-btn-cancel" onclick="closeSignInPrompt()">Later</button>
                <button class="pd-btn pd-btn-primary" onclick="googleLoginFromPrompt()">Sign In</button>
            </div>
        </div>
    </div>
    
    <input type="file" id="import-file-input" accept=".csv" style="display:none" onchange="handleCSVImport(this)">
</div>

<script type="module" src="firebase-config.js"></script>
<script src="app.js"></script>
</body>
</html>
